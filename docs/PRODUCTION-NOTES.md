# Euniテーマ 本番運用メモ

本番環境（例: Xserver）で Euni コーポレートサイトを運用する際の役割分担と設定ポイントをまとめました。ローカル検証手順については `docs/SETUP-LOCAL.md` を参照してください。

## 0. WordPressテーマとは？
WordPress テーマは「サイト全体の見た目やレイアウト、画面遷移、読み込む CSS / JavaScript などをまとめたパッケージ」です。このリポジトリ内の `euni-theme` フォルダがそれに該当し、以下の役割を担います。
- `front-page.php` などのテンプレートファイル … 各ページの HTML 構造や表示順序を定義
- `assets/css` / `assets/js` … デザインやインタラクションを制御
- `functions.php` / `inc` / `lib` … カスタム投稿・カスタマイザー・ショートコードなどサイト固有の機能を提供

つまり「ページをどう見せるか」はすべてテーマ内で完結しており、本番サーバー側ではインフラ（SSL やメール、セキュリティ設定など）と WordPress の基本設定だけを行えば動作します。

## 1. テーマ側で完結する内容
- **画面構成・遷移**: `euni-theme/front-page.php` などテンプレート群で完結。ヘッダー／フッター／セクション構成はテーマ内の PHP / CSS / JS の修正だけで反映される。
- **スタイル・挙動**: `assets/css/*`、`assets/js/main.js` を編集すれば OK。WordPress のビルダーや固定ページ編集は不要。
- **カスタマイザー設定**: 「外観 > カスタマイズ > 会社情報」で入力される会社名・住所・メールアドレスなどは `get_theme_mod` で読み込まれる。表示内容を変えたい場合はテーマコード or カスタマイザー項目を編集する。
- **ニュース投稿**: カスタム投稿タイプ `news` が `inc/custom-post-types.php` で定義済み。管理画面から投稿すれば自動でトップページに反映。

## 2. WordPress 管理画面で必要な設定
1. **テーマの有効化**: 「外観 > テーマ」で「Euni Corporate Theme」を有効にする。
2. **ホームページの表示**: 「設定 > 表示設定」で「ホームページの表示」を固定ページにし、任意のページ（例: Home）を指定。これにより `front-page.php` がフロントに適用される。
3. **お問い合わせメールアドレス**: 「外観 > カスタマイズ > 会社情報 > メールアドレス」に本番用アドレスを入力。未設定の場合は `admin_email` が使われるため、本番では忘れず上書きする。
4. **パーマリンクなど一般設定**: 必要に応じて「設定 > 一般／パーマリンク」でサイト URL や構成を調整。

## 3. サーバー（Xserver）側で行うべき項目
Xserver 側では「セキュリティ → メール → ドメイン/ネットワーク → パフォーマンス」の順で設定すると漏れがありません。

### 3-1. セキュリティ／SSL
1. Xserver サーバーパネルで独自 SSL を有効化（Let’s Encrypt 無料 SSL で可）。
2. WordPress の「設定 > 一般」で `WordPress アドレス` と `サイトアドレス` を `https://` 付きに更新。
3. 必要に応じて `.htaccess` で http→https リダイレクトを追加。
4. WAF（Web アプリケーションファイアウォール）を有効にし、不要な通信は制限。
5. PHP バージョンを 8.0 以上に設定し、WordPress 本体とプラグインを最新化。

### 3-2. メール（お問い合わせ送信先）
1. Xserver のメールアカウント設定で `info@ドメイン` 等の受信アドレスを作成。
2. SPF / DKIM / DMARC レコードを DNS に設定し、送信信用度を確保。
3. 必要なら WP Mail SMTP などのプラグインで SMTP 経由送信を設定（`wp_mail` で配送できない場合の保険）。
4. WordPress 側では「外観 > カスタマイズ > 会社情報 > メールアドレス」に上記アドレスを入力し、フォーム送信先を切り替える。

### 3-3. ドメイン／ネットワーク
1. Xserver に独自ドメインを追加し、DNS を Xserver のネームサーバーに向ける。
2. `wp-config.php` で特別な定義は不要だが、WordPress の `siteurl` / `home` がドメインに合わせているか確認。
3. CDN やリバースプロキシを使う場合は HTTPS とパーマリンク設定が正しく伝搬するようヘッダ設定を行う。

### 3-4. パフォーマンス／バックアップ
1. Xserver の自動バックアップ設定を有効化し、万が一に備える。
2. キャッシュ系プラグインを使う場合は、テーマ更新後にキャッシュ削除を忘れず実行。
3. Cron やジョブが必要であれば Xserver の「CRON 設定」で WordPress の wp-cron を外部起動するなどチューニング。
4. ログ監視（アクセスログ・エラーログ）を定期的に確認し、異常がないかチェック。

### 3-5. プラグイン運用
- **導入自体は自由**: セキュリティ（WP Cerber, Wordfence など）、SMTP（WP Mail SMTP）、バックアップ（UpdraftPlus）、キャッシュ（W3 Total Cache）といった補助プラグインは本番でも適宜追加してよい。
- **互換性の検証**: PHP 8.x / WordPress 6.x と相性が悪いプラグインもあるため、必ずローカルやステージングで事前確認してから本番へ反映。
- **更新ポリシー**: 自動更新を有効にするか、リリースノートを確認してから手動更新するかなど、運用ルールを決める。
- **モジュール重複の回避**: キャッシュやフォームなど同種機能を複数入れると競合しやすいため、目的に応じて最小構成を維持。
- **パフォーマンス監視**: プラグイン追加後は Site Health や Query Monitor を使って応答速度やクエリ負荷を確認し、問題があれば無効化・調整する。

### 3-6. SEO対策
1. **メタ情報の整備**  
   - 「設定 > 一般」でサイトタイトル／キャッチフレーズを本番用に設定。  
   - `front-page.php` は `title-tag` をサポートしているため、ページ別タイトルは WordPress 側の設定に連動します。
2. **SEOプラグインの導入**  
   - README 推奨の Yoast SEO などを導入し、メタディスクリプション・OGP・構造化データをGUIで設定。  
   - サイトマップや robots.txt の自動生成もプラグインに任せる。
3. **パーマリンク / URL 設計**  
   - 「設定 > パーマリンク」で `/%postname%/` など意味のあるスラッグに変更。  
   - ニュース投稿のスラッグ（`news`）が意図通りか確認。
4. **検索エンジン向け登録**  
   - Google Search Console / Bing Webmaster Tools にサイトマップを登録し、インデックスを促進。  
   - Xserver で `robots.txt` をカスタマイズする場合は `public_html/robots.txt` に設置。
5. **パフォーマンス / コアウェブバイタル**  
   - 画像圧縮（WebP など）やキャッシュ設定で表示速度を確保。  
   - PageSpeed Insights を定期的に確認し、CLS/LCP の課題があればテーマ側で調整。

## 4. トラブルシューティング（本番）
- **トップページが崩れる／表示されない**: テーマが有効化されているか、固定ページがホームに設定されているかを再確認。
- **フォームメールが届かない**: カスタマイザーのメールアドレス設定、Xserver のメールボックス設定、PHP の mail() ログ、必要に応じて SMTP プラグイン導入を確認。
- **http/https 混在**: WordPress アドレスが https になっているか、Xserver で SSL が有効かを確認。必要に応じて `.htaccess` にリダイレクトを追加。
- **テーマ更新が反映されない**: キャッシュ系プラグインや CDN を利用している場合は手動でキャッシュ削除。ファイルのアップロード先が `wp-content/themes/euni-theme/` になっているか確認。

上記以外のサーバー固有設定（Cron、アクセス制御など）は通常 Xserver 側のパネルで処理します。テーマ側で対応が必要な場合はコード内の `lib/` や `functions.php` に追記してください。デプロイ作業の詳細は `docs/DEPLOY-XSERVER.md` を参照してください。
